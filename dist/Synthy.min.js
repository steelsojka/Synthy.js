/**
 * Synthy.min.js v0.1
 *
 * A polyphonic customizable synthesizer
 * @author Steven Sojka - Tuesday, February 05, 2013
 *
 * MIT Licensed
 */
var Synthy=function(b){b.initialize=function(a){a=a||{};this.oscCount=a.oscillators||3;this.context=a.context||new webkitAudioContext;this.patch=new b.Patch;this._voices={};this.master=new b.Master(this.patch.master);this.master.output.connect(this.context.destination)};b.trigger=function(a){var c=440*Math.pow(2,(a-69)/12),c=new b.Voice(c);this._voices[a]=c;c.output.connect(this.master.input);c.trigger()};b.release=function(a){a in this._voices&&(this._voices[a].release(),delete this._voices[a])};
return b}(Synthy||{}),Synthy=function(){Synthy.Osc=function(b,a){this.modOsc=Synthy.context.createOscillator();this.tremelo=Synthy.context.createGainNode();this.osc=Synthy.context.createOscillator();this.output=this.mix=Synthy.context.createGainNode();this.osc.connect(this.mix);this.tremelo.gain.value=b.mod.mix;this.modOsc.frequency.value=b.mod.rate;this.osc.frequency.value=a;this.osc.detune.value=b.detune;this.osc.type=b.type;this.mix.gain.value=b.mix};Synthy.Osc.prototype={trigger:function(){this.modOsc.start(0);
this.osc.start(0)},release:function(b){var a=Synthy.context.currentTime;this.modOsc.stop(a+b);this.osc.stop(a+b)}};return Synthy}(Synthy||{}),Synthy=function(b){b.Envelope=function(a){this.envelope=b.context.createGainNode();this.envelope.gain.value=0;this.patch=a;this.input=this.output=this.envelope};b.Envelope.prototype={trigger:function(){var a=b.context.currentTime,c=a+this.patch.A/10;this.envelope.gain.setValueAtTime(0,a);this.envelope.gain.linearRampToValueAtTime(1,c);this.envelope.gain.setTargetValueAtTime(this.patch.S/
100,c,this.patch.D/100+0.0010)},release:function(){var a=b.context.currentTime;this.envelope.gain.cancelScheduledValues(a);this.envelope.gain.setValueAtTime(this.envelope.gain.value,a);this.envelope.gain.linearRampToValueAtTime(0,a+this.patch.R/100)},getReleaseTime:function(){return this.patch.R/100}};return b}(Synthy||{}),Synthy=function(b){b.Filter=function(a,c){this.filter=b.context.createBiquadFilter();this.filter.frequency.value=a.cutoff;this.filter.Q.value=a.q;this.filter.type=a.type;this.freq=
c;this.env=a.env;this.patch=a;this.input=this.output=this.filter};b.Filter.prototype={trigger:function(){var a=this.patch,c=b.context.currentTime;this.startLevel=this.frequencyFromCutoff(a.cutoff/100);this.attackLevel=this.frequencyFromCutoff(a.cutoff/100+this.env/120);this.sustainLevel=this.frequencyFromCutoff(a.cutoff/100+this.env/120*(a.S/100));this.attackEnd=c+a.A/20;this.filter.frequency.value=this.startLevel;this.filter.frequency.setValueAtTime(this.startLevel,c);this.filter.frequency.linearRampToValueAtTime(this.attackLevel,
this.attackEnd);this.filter.frequency.setTargetValueAtTime(this.sustainLevel,this.attackEnd,a.D/100)},frequencyFromCutoff:function(a){var c=0.5*b.context.sampleRate,a=Math.pow(2,9*a-1)*this.freq;a>c&&(a=c);return a},release:function(){var a=b.context.currentTime;this.filter.frequency.cancelScheduledValues(a);this.filter.frequency.setValueAtTime(this.filter.frequency.value,a);this.filter.frequency.linearRampToValueAtTime(this.startLevel,a+this.patch.R/100)}};return b}(Synthy||{}),Synthy=function(b){b.Master=
function(a){this.input=this.output=b.context.createGainNode();this.output.gain.value=a.output};b.Master.prototype={};return b}(Synthy||{}),Synthy=function(){Synthy.Voice=function(b){var a=Synthy.patch;this.osc=[];this.envelope=new Synthy.Envelope(a.volumeEnv);this.filter=new Synthy.Filter(a.filter[0],b);for(var c=0,d=a.osc.length;c<d;c++)this.osc.push(new Synthy.Osc(a.osc[c],b)),this.osc[c].output.connect(this.filter.input);this.filter.output.connect(this.envelope.input);this.output=this.envelope.output};
Synthy.Voice.prototype={trigger:function(){for(var b=0,a=this.osc.length;b<a;b++)this.osc[b].trigger();this.filter.trigger();this.envelope.trigger()},release:function(){this.envelope.release();this.filter.release();for(var b=0,a=this.osc.length;b<a;b++)this.osc[b].release(this.envelope.getReleaseTime())}};return Synthy}(Synthy||{}),Synthy=function(){Synthy.Patch=function(){var b=Synthy;this.osc=[];for(var a=0;a<b.oscCount;a++)this.osc.push({mod:{rate:10,mix:0},freq:440,detune:0,mix:1,type:1});this.filter=
[{cutoff:100,q:5,mod:10,type:0,env:67,A:0,D:0,S:5,R:5}];this.volumeEnv={A:0,D:0,S:100,R:0};this.master={drive:0,output:1}};Synthy.Patch.prototype={save:function(){},setOscProperty:function(b,a,c){this.osc[b][a]=c},setFilterProperty:function(b,a){this.filter[b]=a},setVolumeEnvelope:function(b,a,c,d){this.volumeEnv.A=b;this.volumeEnv.D=a;this.volumeEnv.S=c;this.volumeEnv.R=d},setMaster:function(b,a){this.master[b]=a}};return Synthy}(Synthy||{});
